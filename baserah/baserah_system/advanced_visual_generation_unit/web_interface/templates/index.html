<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¨ØµÙŠØ±Ø© - Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ø«ÙˆØ±ÙŠ</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            margin: 20px auto;
            padding: 30px;
            max-width: 1400px;
        }
        
        .header-section {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 15px;
            color: white;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }
        
        .preview-area {
            background: #ffffff;
            border-radius: 15px;
            padding: 25px;
            min-height: 400px;
            border: 2px dashed #dee2e6;
            text-align: center;
        }
        
        .shape-card {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .shape-card:hover {
            border-color: #007bff;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .shape-card.selected {
            border-color: #28a745;
            background: #f8fff9;
        }
        
        .btn-generate {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            color: white;
            transition: all 0.3s ease;
        }
        
        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(40, 167, 69, 0.3);
        }
        
        .progress-container {
            display: none;
            margin-top: 20px;
        }
        
        .result-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stats-widget {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
        }
        
        .effect-tag {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin: 2px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .gallery-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin: 10px;
            background: white;
            transition: all 0.3s ease;
        }
        
        .gallery-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .quality-meter {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin: 5px 0;
        }
        
        .quality-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc3545, #ffc107, #28a745);
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="main-container">
            <!-- Header -->
            <div class="header-section">
                <h1><i class="fas fa-palette"></i> Ù†Ø¸Ø§Ù… Ø¨ØµÙŠØ±Ø© Ù„Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨ØµØ±ÙŠ Ø§Ù„Ø«ÙˆØ±ÙŠ</h1>
                <p class="lead">Ø¥Ø¨Ø¯Ø§Ø¹ Ø¨Ø§Ø³Ù„ ÙŠØ­ÙŠÙ‰ Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ù† Ø§Ù„Ø¹Ø±Ø§Ù‚/Ø§Ù„Ù…ÙˆØµÙ„</p>
                <p>ğŸ–¼ï¸ ØªÙˆÙ„ÙŠØ¯ ØµÙˆØ± + ğŸ¬ Ø¥Ù†Ø´Ø§Ø¡ ÙÙŠØ¯ÙŠÙˆ + ğŸ¨ Ø±Ø³Ù… Ù…ØªÙ‚Ø¯Ù… + ğŸ”¬ ÙÙŠØ²ÙŠØ§Ø¡ + ğŸ§  Ø®Ø¨ÙŠØ±</p>
            </div>

            <div class="row">
                <!-- Control Panel -->
                <div class="col-lg-4">
                    <div class="control-panel">
                        <h3><i class="fas fa-cogs"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                        
                        <!-- Shape Selection -->
                        <div class="mb-4">
                            <h5><i class="fas fa-shapes"></i> Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø´ÙƒÙ„</h5>
                            <div id="shapesContainer" class="row">
                                <div class="col-12 text-center">
                                    <div class="loading-spinner"></div>
                                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø´ÙƒØ§Ù„...</p>
                                </div>
                            </div>
                        </div>

                        <!-- Output Types -->
                        <div class="mb-4">
                            <h5><i class="fas fa-file-image"></i> Ù†ÙˆØ¹ Ø§Ù„Ù…Ø®Ø±Ø¬Ø§Øª</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="image" id="outputImage" checked>
                                <label class="form-check-label" for="outputImage">ØµÙˆØ±Ø© Ø«Ø§Ø¨ØªØ©</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="artwork" id="outputArtwork">
                                <label class="form-check-label" for="outputArtwork">Ø¹Ù…Ù„ ÙÙ†ÙŠ</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="video" id="outputVideo">
                                <label class="form-check-label" for="outputVideo">ÙÙŠØ¯ÙŠÙˆ Ù…ØªØ­Ø±Ùƒ</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" value="animation" id="outputAnimation">
                                <label class="form-check-label" for="outputAnimation">Ø±Ø³Ù… Ù…ØªØ­Ø±Ùƒ</label>
                            </div>
                        </div>

                        <!-- Quality Level -->
                        <div class="mb-4">
                            <h5><i class="fas fa-star"></i> Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¬ÙˆØ¯Ø©</h5>
                            <select class="form-select" id="qualityLevel">
                                <option value="standard">Ø¬ÙˆØ¯Ø© Ø¹Ø§Ø¯ÙŠØ© (1280x720)</option>
                                <option value="high" selected>Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© (1920x1080)</option>
                                <option value="ultra">Ø¬ÙˆØ¯Ø© ÙØ§Ø¦Ù‚Ø© (2560x1440)</option>
                                <option value="masterpiece">ØªØ­ÙØ© ÙÙ†ÙŠØ© (3840x2160)</option>
                            </select>
                        </div>

                        <!-- Artistic Style -->
                        <div class="mb-4">
                            <h5><i class="fas fa-brush"></i> Ø§Ù„Ù†Ù…Ø· Ø§Ù„ÙÙ†ÙŠ</h5>
                            <select class="form-select" id="artisticStyle">
                                <option value="photorealistic">ÙˆØ§Ù‚Ø¹ÙŠ ÙÙˆØªÙˆØºØ±Ø§ÙÙŠ</option>
                                <option value="digital_art" selected>ÙÙ† Ø±Ù‚Ù…ÙŠ</option>
                                <option value="impressionist">Ø§Ù†Ø·Ø¨Ø§Ø¹ÙŠ</option>
                                <option value="watercolor">Ø£Ù„ÙˆØ§Ù† Ù…Ø§Ø¦ÙŠØ©</option>
                                <option value="oil_painting">Ø±Ø³Ù… Ø²ÙŠØªÙŠ</option>
                                <option value="anime">Ø£Ù†Ù…ÙŠ</option>
                                <option value="abstract">ØªØ¬Ø±ÙŠØ¯ÙŠ</option>
                            </select>
                        </div>

                        <!-- Advanced Options -->
                        <div class="mb-4">
                            <h5><i class="fas fa-sliders-h"></i> Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©</h5>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="physicsSimulation" checked>
                                <label class="form-check-label" for="physicsSimulation">Ù…Ø­Ø§ÙƒØ§Ø© ÙÙŠØ²ÙŠØ§Ø¦ÙŠØ©</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="expertAnalysis" checked>
                                <label class="form-check-label" for="expertAnalysis">ØªØ­Ù„ÙŠÙ„ Ø®Ø¨ÙŠØ±</label>
                            </div>
                        </div>

                        <!-- Visual Effects -->
                        <div class="mb-4">
                            <h5><i class="fas fa-magic"></i> Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¨ØµØ±ÙŠØ©</h5>
                            <div class="row">
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="glow" id="effectGlow">
                                        <label class="form-check-label" for="effectGlow">ØªÙˆÙ‡Ø¬</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="sharpen" id="effectSharpen">
                                        <label class="form-check-label" for="effectSharpen">Ø­Ø¯Ø©</label>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="enhance" id="effectEnhance">
                                        <label class="form-check-label" for="effectEnhance">ØªØ­Ø³ÙŠÙ†</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" value="neon" id="effectNeon">
                                        <label class="form-check-label" for="effectNeon">Ù†ÙŠÙˆÙ†</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <div class="text-center">
                            <button class="btn btn-generate" id="generateBtn" onclick="generateContent()">
                                <i class="fas fa-rocket"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨ØµØ±ÙŠ
                            </button>
                        </div>

                        <!-- Progress -->
                        <div class="progress-container" id="progressContainer">
                            <div class="progress">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                     role="progressbar" style="width: 0%"></div>
                            </div>
                            <p class="text-center mt-2" id="progressText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</p>
                        </div>
                    </div>

                    <!-- Stats Widget -->
                    <div class="stats-widget">
                        <h5><i class="fas fa-chart-bar"></i> Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</h5>
                        <div class="row">
                            <div class="col-6">
                                <div><strong id="totalRequests">0</strong></div>
                                <small>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</small>
                            </div>
                            <div class="col-6">
                                <div><strong id="successRate">0%</strong></div>
                                <small>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview and Results -->
                <div class="col-lg-8">
                    <!-- Preview Area -->
                    <div class="preview-area" id="previewArea">
                        <i class="fas fa-image fa-5x text-muted mb-3"></i>
                        <h4 class="text-muted">Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</h4>
                        <p class="text-muted">Ø§Ø®ØªØ± Ø´ÙƒÙ„Ø§Ù‹ ÙˆØ§Ù†Ù‚Ø± Ø¹Ù„Ù‰ "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¨ØµØ±ÙŠ" Ù„Ø¨Ø¯Ø¡ Ø§Ù„ØªÙˆÙ„ÙŠØ¯</p>
                    </div>

                    <!-- Results Container -->
                    <div id="resultsContainer" class="mt-4"></div>

                    <!-- Gallery -->
                    <div class="mt-4">
                        <h4><i class="fas fa-images"></i> Ù…Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø§Ù„Ù…ÙˆÙ„Ø¯Ø©</h4>
                        <div id="galleryContainer" class="row">
                            <div class="col-12 text-center">
                                <p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆÙ„Ø¯Ø© Ø¨Ø¹Ø¯</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        let selectedShapeId = null;
        let currentRequestId = null;

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø´ÙƒØ§Ù„ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        document.addEventListener('DOMContentLoaded', function() {
            loadShapes();
            loadStats();
            loadGallery();
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(loadStats, 30000);
        });

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø´ÙƒØ§Ù„ Ø§Ù„Ù…ØªØ§Ø­Ø©
        async function loadShapes() {
            try {
                const response = await fetch('/api/shapes');
                const data = await response.json();
                
                if (data.success) {
                    displayShapes(data.shapes);
                } else {
                    console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø´ÙƒØ§Ù„:', data.error);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„:', error);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø´ÙƒØ§Ù„
        function displayShapes(shapes) {
            const container = document.getElementById('shapesContainer');
            container.innerHTML = '';

            shapes.forEach(shape => {
                const shapeCard = document.createElement('div');
                shapeCard.className = 'col-12 shape-card';
                shapeCard.onclick = () => selectShape(shape.id, shapeCard);
                
                const colorStyle = `background-color: rgb(${shape.color.join(',')})`;
                
                shapeCard.innerHTML = `
                    <div class="d-flex align-items-center">
                        <div class="rounded-circle me-3" style="${colorStyle}; width: 30px; height: 30px;"></div>
                        <div>
                            <strong>${shape.name}</strong>
                            <br><small class="text-muted">${shape.category}</small>
                        </div>
                    </div>
                `;
                
                container.appendChild(shapeCard);
            });
        }

        // Ø§Ø®ØªÙŠØ§Ø± Ø´ÙƒÙ„
        function selectShape(shapeId, cardElement) {
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
            document.querySelectorAll('.shape-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø´ÙƒÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯
            cardElement.classList.add('selected');
            selectedShapeId = shapeId;
        }

        // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
        async function generateContent() {
            if (!selectedShapeId) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø´ÙƒÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                return;
            }

            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬
            const outputTypes = [];
            document.querySelectorAll('input[type="checkbox"]:checked').forEach(checkbox => {
                if (['image', 'artwork', 'video', 'animation'].includes(checkbox.value)) {
                    outputTypes.push(checkbox.value);
                }
            });

            if (outputTypes.length === 0) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ù…Ø®Ø±Ø¬Ø§Øª ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            const customEffects = [];
            document.querySelectorAll('input[id^="effect"]:checked').forEach(checkbox => {
                customEffects.push(checkbox.value);
            });

            const requestData = {
                shape_id: selectedShapeId,
                output_types: outputTypes,
                quality_level: document.getElementById('qualityLevel').value,
                artistic_styles: [document.getElementById('artisticStyle').value],
                physics_simulation: document.getElementById('physicsSimulation').checked,
                expert_analysis: document.getElementById('expertAnalysis').checked,
                custom_effects: customEffects,
                output_resolution: getResolutionFromQuality(document.getElementById('qualityLevel').value),
                animation_duration: 5.0
            };

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
            try {
                showProgress();
                
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                const data = await response.json();
                
                if (data.success) {
                    currentRequestId = data.request_id;
                    pollForResult(data.request_id);
                } else {
                    hideProgress();
                    alert('Ø®Ø·Ø£: ' + data.error);
                }
            } catch (error) {
                hideProgress();
                alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message);
            }
        }

        // Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        async function pollForResult(requestId) {
            try {
                const response = await fetch(`/api/result/${requestId}`);
                const data = await response.json();
                
                if (data.success && data.status === 'completed') {
                    hideProgress();
                    displayResult(data.result);
                    loadGallery(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ø±Ø¶
                    loadStats(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                } else if (data.status === 'processing') {
                    // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± ÙˆØ§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰
                    setTimeout(() => pollForResult(requestId), 2000);
                } else {
                    hideProgress();
                    alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªÙŠØ¬Ø©');
                }
            } catch (error) {
                hideProgress();
                alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø§Ù„Ù†ØªÙŠØ¬Ø©: ' + error.message);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø¯Ù…
        function showProgress() {
            document.getElementById('generateBtn').disabled = true;
            document.getElementById('progressContainer').style.display = 'block';
            
            let progress = 0;
            const progressBar = document.querySelector('.progress-bar');
            const progressText = document.getElementById('progressText');
            
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                
                progressBar.style.width = progress + '%';
                progressText.textContent = `Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©... ${Math.round(progress)}%`;
            }, 500);
            
            // Ø­ÙØ¸ Ø§Ù„Ù…Ø¤Ù‚Øª Ù„Ø¥ÙŠÙ‚Ø§ÙÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
            window.progressInterval = interval;
        }

        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªÙ‚Ø¯Ù…
        function hideProgress() {
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('progressContainer').style.display = 'none';
            
            if (window.progressInterval) {
                clearInterval(window.progressInterval);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
        function displayResult(result) {
            const container = document.getElementById('resultsContainer');
            
            const resultCard = document.createElement('div');
            resultCard.className = 'result-card';
            
            let contentHtml = '';
            for (const [type, path] of Object.entries(result.generated_content)) {
                const quality = result.quality_metrics[type] || 0;
                const artistic = result.artistic_scores[type] || 0;
                
                contentHtml += `
                    <div class="mb-3">
                        <h6><i class="fas fa-file"></i> ${getTypeLabel(type)}</h6>
                        <p><strong>Ø§Ù„Ù…Ù„Ù:</strong> ${path}</p>
                        <div class="row">
                            <div class="col-6">
                                <small>Ø¬ÙˆØ¯Ø©: ${(quality * 100).toFixed(1)}%</small>
                                <div class="quality-meter">
                                    <div class="quality-fill" style="width: ${quality * 100}%"></div>
                                </div>
                            </div>
                            <div class="col-6">
                                <small>ÙÙ†ÙŠ: ${(artistic * 100).toFixed(1)}%</small>
                                <div class="quality-meter">
                                    <div class="quality-fill" style="width: ${artistic * 100}%"></div>
                                </div>
                            </div>
                        </div>
                        <a href="/download/${path}" class="btn btn-sm btn-primary me-2">
                            <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„
                        </a>
                        <a href="/preview/${path}" target="_blank" class="btn btn-sm btn-secondary">
                            <i class="fas fa-eye"></i> Ù…Ø¹Ø§ÙŠÙ†Ø©
                        </a>
                    </div>
                `;
            }
            
            resultCard.innerHTML = `
                <h5><i class="fas fa-check-circle text-success"></i> ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¨Ù†Ø¬Ø§Ø­!</h5>
                <p><strong>ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:</strong> ${result.processing_time.toFixed(2)} Ø«Ø§Ù†ÙŠØ©</p>
                ${contentHtml}
                ${result.recommendations.length > 0 ? `
                    <div class="mt-3">
                        <h6><i class="fas fa-lightbulb"></i> Ø§Ù„ØªÙˆØµÙŠØ§Øª:</h6>
                        <ul>
                            ${result.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>
                ` : ''}
            `;
            
            container.appendChild(resultCard);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalRequests').textContent = data.interface_stats.total_requests;
                    document.getElementById('successRate').textContent = data.interface_stats.success_rate.toFixed(1) + '%';
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª:', error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø±Ø¶
        async function loadGallery() {
            try {
                const response = await fetch('/api/gallery');
                const data = await response.json();
                
                if (data.success) {
                    displayGallery(data.gallery);
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø±Ø¶:', error);
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø±Ø¶
        function displayGallery(items) {
            const container = document.getElementById('galleryContainer');
            
            if (items.length === 0) {
                container.innerHTML = '<div class="col-12 text-center"><p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¹Ù…Ø§Ù„ Ù…ÙˆÙ„Ø¯Ø© Ø¨Ø¹Ø¯</p></div>';
                return;
            }
            
            container.innerHTML = '';
            
            items.slice(0, 6).forEach(item => {
                const galleryItem = document.createElement('div');
                galleryItem.className = 'col-md-4 gallery-item';
                
                galleryItem.innerHTML = `
                    <h6>${item.shape_name}</h6>
                    <small class="text-muted">${new Date(item.creation_date).toLocaleString('ar')}</small>
                    <div class="mt-2">
                        ${Object.keys(item.generated_content).map(type => 
                            `<span class="effect-tag">${getTypeLabel(type)}</span>`
                        ).join('')}
                    </div>
                    <div class="mt-2">
                        <small>ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${item.processing_time.toFixed(2)}Ø«</small>
                    </div>
                `;
                
                container.appendChild(galleryItem);
            });
        }

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        function getResolutionFromQuality(quality) {
            const resolutions = {
                'standard': [1280, 720],
                'high': [1920, 1080],
                'ultra': [2560, 1440],
                'masterpiece': [3840, 2160]
            };
            return resolutions[quality] || [1920, 1080];
        }

        function getTypeLabel(type) {
            const labels = {
                'image': 'ØµÙˆØ±Ø©',
                'video': 'ÙÙŠØ¯ÙŠÙˆ',
                'artwork': 'Ø¹Ù…Ù„ ÙÙ†ÙŠ',
                'animation': 'Ø±Ø³Ù… Ù…ØªØ­Ø±Ùƒ'
            };
            return labels[type] || type;
        }
    </script>
</body>
</html>
